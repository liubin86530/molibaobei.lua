local Module = ModuleBase:createModule('imagechange')

local ChangeItemId = 20210009
local ChangeItemName = "形象卡" ---不能超过3个字

local Npclist = {
  --{npc图档编号,地图编号,x,y,地图类型,方向,斧形象,弓形象,空手,剑,魔杖,长枪}
  {105630,7003,25,41,0,4,105628,105629,105630,105631,105632,105633},
  {118267,7003,27,41,0,4,118265,118266,118267,118268,118269,118270},
  {118273,7003,29,41,0,4,118271,118272,118273,118274,118275,118276},
  {105612,7003,31,41,0,4,105610,105611,105612,105613,105614,105615},
  {105636,7003,33,41,0,4,105634,105635,105636,105637,105638,105639},
  {106854,7003,35,41,0,4,106852,106853,106854,106855,106856,106857},
  {106860,7003,25,38,0,4,106858,106859,106860,106861,106862,106863},
  {106868,7003,27,38,0,4,106866,106867,106868,106869,106870,106871},
  {118146,7003,29,38,0,4,118144,118145,118146,118147,118148,118149},
  {118357,7003,31,38,0,4,118355,118356,118357,118358,118359,118360},
  {118164,7003,33,38,0,4,118162,118163,118164,118165,118166,118167},
  {118363,7003,35,38,0,4,118361,118362,118363,118364,118365,118366},
  {118158,7003,25,35,0,4,118156,118157,118158,118159,118160,118161},
  {118116,7003,27,35,0,4,118114,118115,118116,118117,118118,118119},
  {118170,7003,29,35,0,4,118168,118169,118170,118171,118172,118173},
  {118369,7003,31,35,0,4,118367,118368,118369,118370,118371,118372},
  {100884,7003,33,35,0,4,100882,100883,100884,101885,101886,101887},
  {100932,7003,35,35,0,4,100930,100931,100932,100933,100934,100935},
  {105810,7003,25,32,0,4,105808,105809,105810,105811,105812,105813},
  {105828,7003,27,32,0,4,105826,105827,105828,105829,105830,105831},
  {105816,7003,29,32,0,4,105814,105815,105816,105817,105818,105819},
  {105822,7003,31,32,0,4,105820,105821,105822,105823,105824,105825},
  {105834,7003,33,32,0,4,105832,105833,105834,105835,105836,105837},
  {118315,7003,35,32,0,4,118313,118314,118315,118316,118317,118318},
  {118002,7003,25,29,0,4,118000,118001,118002,118003,118004,118005},
  {118321,7003,27,29,0,4,118319,118320,118321,118322,118323,118324},
  {118327,7003,29,29,0,4,118325,118326,118327,118328,118329,118330},
  {118339,7003,31,29,0,4,118337,118338,118339,118340,118341,118342},
  {118008,7003,33,29,0,4,118006,118007,118008,118009,118010,118011},
  {118020,7003,35,29,0,4,118018,118019,118020,118021,118022,118023},
  {100968,7003,25,26,0,4,100966,100967,100968,100969,100970,100971},
  {100890,7003,27,26,0,4,101888,100889,100890,100891,100892,100893},
  {105804,7003,29,26,0,4,105802,105803,105804,105805,105806,105807},
  {105696,7003,31,26,0,4,105694,105695,105696,105697,105698,105699},
  {118050,7003,33,26,0,4,118048,118049,118050,118051,118052,118053},
  {105792,7003,35,26,0,4,105790,105791,105792,105793,105794,105795},
  {118279,7003,42,41,0,4,118277,118278,118279,118280,118281,118282},
  {118285,7003,44,41,0,4,118283,118284,118285,118286,118287,118288},
  {118291,7003,46,41,0,4,118289,118290,118291,118292,118293,118294},
  {118297,7003,48,41,0,4,118295,118296,118297,118298,118299,118300},
  {118303,7003,50,41,0,4,118301,118302,118303,118304,118305,118306},
  {105678,7003,42,38,0,4,105676,105677,105678,105679,105680,105681},
  {105684,7003,44,38,0,4,105682,105683,105684,105685,105686,105687},
  {118309,7003,46,38,0,4,118307,118308,118309,118310,118311,118312},
  {105846,7003,48,38,0,4,105844,105845,105846,105847,105848,105849},
  {105840,7003,50,38,0,4,105838,105839,105840,105841,105842,105843},
  {105798,7003,42,35,0,4,105796,105797,105798,105799,105800,105801},
  {105774,7003,44,35,0,4,105772,105773,105774,105775,105776,105777},
  {118032,7003,46,35,0,4,118030,118031,118032,118033,118034,118035},
  {118333,7003,48,35,0,4,118331,118332,118333,118334,118335,118336},
  {105786,7003,50,35,0,4,105784,105785,105786,105787,105788,105789},
  {105756,7003,42,32,0,4,105754,105755,105756,105757,105758,105759},
  {105762,7003,44,32,0,4,105760,105761,105762,105763,105764,105765},
  {106874,7003,46,32,0,4,106872,106873,106874,106875,106876,106877},
  {118375,7003,48,32,0,4,118373,118374,118375,118376,118377,118378},
  {118387,7003,50,32,0,4,118385,118386,118387,118388,118389,118390},
  {118122,7003,42,29,0,4,118120,118121,118122,118123,118124,118125},
  {105852,7003,44,29,0,4,105850,105851,105852,105853,105854,105855},
  {118345,7003,46,29,0,4,118343,118344,118345,118346,118347,118348},
  {118351,7003,48,29,0,4,118349,118350,118351,118352,118353,118354},
  {106627,7003,50,29,0,4,106625,106626,106627,106628,106629,106630},
  {106602,7003,50,26,0,4,106600,106601,106602,106603,106604,106605},
  {106652,7003,48,26,0,4,106650,106651,106652,106653,106654,106655},
  {106577,7003,46,26,0,4,106575,106576,106577,106578,106579,106580},  
  {106552,7003,44,26,0,4,106550,106551,106552,106553,106554,106555},  
  {160004,7003,42,26,0,4,160002,160003,160004,160005,160006,160007},  
  {160016,7003,42,23,0,4,160014,160015,160016,160017,160018,160019},  
  {160022,7003,44,23,0,4,160020,160021,160022,160023,160024,160025},  
  {160028,7003,46,23,0,4,160026,160027,160028,160029,160030,160031},  
  {160052,7003,48,23,0,4,160050,160051,160052,160053,160054,160055},  
  {160058,7003,50,23,0,4,160056,160057,160058,160059,160060,160061},  
  

}

--- 加载模块钩子
function Module:onLoad()
  for i = 1,#Npclist do
    self.npc = self:NPC_createNormal("",Npclist[i][1],{map = Npclist[i][2], x = Npclist[i][3], y = Npclist[i][4], mapType = Npclist[i][5], direction = Npclist[i][6]})
    self:NPC_regTalkedEvent(self.npc, Func.bind(self.Talked, self, i));
    self:NPC_regWindowTalkedEvent(self.npc, Func.bind(self.WinTalked, self, i));
  end
end

--- 卸载模块钩子
function Module:onUnload()
  self:logInfo('unload')
end

function Module:Talked(Num,npc, player)
  --if NLG.CanTalk(npc, player) then
  print("Num:"..Num)
    NLG.ShowWindowTalked(player, npc, CONST.窗口_选择框, CONST.BUTTON_关闭, 10,
    "1\n请选择你要变换的造型类型,需要消耗一张["..ChangeItemName.."]"..
    "\n斧形象"..
    "\n弓形象"..
    "\n空手"..
    "\n剑形象"..
    "\n魔杖形象"..
    "\n长枪形象");
  --end
end

function Module:WinTalked(Num, npc, player,_SeqNo, _Select, _Data)
  if _Select == 2 then
    return
  end

  if _SeqNo == 10 then
    local itemindex = Char.HaveItem(player,ChangeItemId);
    if (itemindex<0)  then 
      NLG.ShowWindowTalked(player,npc,0,1,12,"抱歉,你的道具不够!");
      return
    else
      Char.DelItem(player,ChangeItemId,1)
      local imageID = Npclist[Num][6 + tonumber(_Data)]
      Char.SetData(player, CONST.对象_原始图档, imageID)
      Char.SetData(player, CONST.对象_原形, imageID)
      NLG.UpChar(player)
      NLG.ShowWindowTalked(player,npc,0,1,12,"你的形象已经改变了!");
      return
    end
  end

end

return Module;
